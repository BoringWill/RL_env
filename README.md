这是一个基于 **深度强化学习（Deep Reinforcement Learning）** 的史莱姆排球（Slime Volleyball）自博弈项目。它包含了完整的物理引擎、Gymnasium 游戏环境封装、PPO 算法实现，以及一套成熟的“固定对手迭代进化”训练机制。

---

# 项目名称：Slime Volleyball RL - 自博弈进化实验室

## 1. 项目核心设计

### 1.1 物理引擎 (`entities.py`, `constants.py`)

项目在 `pygame` 的基础上实现了一个精简的 2D 物理引擎：

* **镜像对称性**：环境支持从 P2 视角进行水平镜像处理，使同一个神经网络可以同时控制两个玩家。
* **物理参数定制**：通过 `constants.py` 调节重力（GRAVITY）、跳跃力度（JUMP_POWER）和球速上限。
* **碰撞检测**：实现了球与史莱姆（半圆）以及球与球网（矩形）的弹性碰撞算法。

### 1.2 环境封装 (`slime_env.py`)

基于 **Gymnasium** 标准接口构建：

* **观测空间 (Observation Space)**：12维状态向量（包含 P1/P2 的坐标、速度以及球的坐标、速度）。
* **动作空间 (Action Space)**：离散 4 动作（不动、向左、向右、跳跃）。
* **帧堆叠 (FrameStack)**：通过包装器将连续 4 帧的状态拼接（48维输入），使 AI 能够感知物体的“速度”和“加速度”方向。

---

## 2. 训练机制：固定对手迭代法 (League Training)

为了解决自博弈中常见的“策略崩溃”和“循环相克”问题，本项目推荐采用以下逻辑进行训练（对应 `train_fixed_opponent.py`）：

1. **阶段 1 (靶子训练)**：加载一个初始强力模型（如 `v2.pth`）作为固定对手（P2）。
2. **阶段 2 (突破瓶颈)**：学习器（P1）在数千万步的对局中不断优化策略。
3. **阶段 3 (自我超越)**：当 P1 对阵固定对手的**最近 10 局胜率**稳定超过 90% 时，将 P1 的当前模型权重覆盖给 P2 的模型文件夹。
4. **阶段 4 (持续进化)**：重复上述过程，让 AI 在“打败更强的自己”的过程中不断进化。

---

## 3. 主要脚本说明

| 脚本名称 | 核心功能 | 使用场景 |
| --- | --- | --- |
| **`train_gpu.py`** | 纯自博弈训练 | 让两个最新的模型实时对抗，适合初始探索。 |
| **`train_fixed_opponent.py`** | 固定对手续训 | 针对特定版本的对手进行攻克，实现阶梯式进化。 |
| **`enjoy_vs_fixed.py`** | 10 分制观战模式 | 加载两个特定模型，在 Pygame 窗口中观察 10 分制比赛。 |
| **`enjoy.py`** | 人机对战/展示 | 支持 `human_mode=True`，允许用户使用 A/D/W 键挑战 AI。 |

---

## 4. 关键技术特性

* **PPO 算法优化**：采用了 **GAE (Generalized Advantage Estimation)** 优势估计、**线性熵系数衰减**（保持前期探索，后期收敛）以及 **梯度裁剪**。
* **多环境并行采样**：支持 `num_envs=32` 的异步并行环境采样，极大提升了在 GPU 上的训练速度。
* **自动化归一化**：在 `_get_obs` 中将位置坐标和速度映射至 `[-1, 1]` 区间，加速神经网络收敛。
* **阶段性存档**：每 1,000,000 步自动将模型保存至 `模型集_opponent/`，防止训练回退。

---

## 5. 快速上手指南

1. **环境配置**：
```bash
pip install torch gymnasium pygame tensorboard

```


2. **启动进阶训练**：
确保 `模型集/` 下有初始权重，运行：
```bash
python train_fixed_opponent.py

```


3. **实时监控**：
```bash
tensorboard --logdir=runs

```


4. **挑战 AI**：
修改 `enjoy.py` 中的 `human_mode=True` 并运行，测试你的操作是否能战胜深度学习产出的史莱姆。

---

**下一步建议**：
如果你希望 AI 变得更强，可以尝试在 `entities.py` 中稍微提高 `speed_multiplier`，让 AI 在更高的球速压力下进化。
